version: "v1.0"
name: First pipeline example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: "Check Changes"
    task:
      jobs:
        - name: List of changes
          commands:
            - checkout
            - git diff-tree --no-commit-id --name-only $SEMAPHORE_GIT_SHA

  - name: "Execute on master"
    task:
      jobs:
        - name: Deploy
          commands:
            - checkout
            - bundle install --deployment --path vendor/bundle
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then ./deploy_docs.rb; fi

      secrets:
        - name: helpscout-docs
          env_var_names: []
